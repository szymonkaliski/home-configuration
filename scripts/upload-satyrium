#!/usr/bin/env bash

# Check for correct number of arguments
if [ $# -lt 1 ]; then
  echo "Usage: $0 <filename1> [<filename2> ... <filenameN>]"
  exit 1
fi

# Define variables
REMOTE_HOST="satyrium"
REMOTE_URL="http://satyrium.pl:8080/shared"
REMOTE_DIR="/home/szymon/Public/shared"

# Loop through each argument (filename)
for file in "$@"; do
  # Check if file exists in local directory
  if [ ! -f "$file" ]; then
    echo "File '$file' does not exist in local directory."
    continue
  fi

  # Get file extension
  extension="${file##*.}"

  # Remove extension from filename
  filename="${file%.*}"

  # Store final filename
  final_file="$file"

  # Check if file already exists on remote host
  if ssh $REMOTE_HOST [ -f "$REMOTE_DIR/$file" ]; then
    # If file already exists, add timestamp to file name
    timestamp=$(date +%Y%m%d%H%M%S)

    if [ "$extension" = "$filename" ]; then
      new_filename="${filename}-${timestamp}"
    else
      new_filename="${filename}-${timestamp}.${extension}"
    fi

    final_file="$new_filename"
  fi

  # Upload the file
  scp "$file" "$REMOTE_HOST:$REMOTE_DIR/$final_file"

  # Echo uploaded path and add to clipboard
  echo
  echo "Uploaded: $REMOTE_URL/$final_file"
  echo "$REMOTE_URL/$final_file" | pbcopy
done

